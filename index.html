function submitReservation() {
  if (!validateForm()) {
    showToast('COMPLETA TODOS LOS CAMPOS OBLIGATORIOS', 'error');
    return;
  }

  submitBooking.disabled = true;
  submitBooking.innerHTML = '<span class="spinner"></span> GUARDANDO...';
  
  var grupoSelect = document.getElementById('grupo');
  var selectedGrupo = grupoSelect.options[grupoSelect.selectedIndex];
  var grupoData = selectedGrupo.text.split(' | ');
  
  // CORRECCIÃ“N: Usar los nombres de campos que espera el Apps Script
  var reservationData = {
    action: 'reservation',
    nombreEquipo: document.getElementById('teamName').value.trim(),
    materia: document.getElementById('subject').value,
    profesor: grupoData[0] + ' - ' + grupoData[1] + ' - ' + (grupoData[2] || ''),
    fecha: selectedDate,
    hora: selectedTime,
    integrantes: parseInt(studentCountInput.value),
    responsable: document.getElementById('representativeName').value.trim(),
    correo: document.getElementById('email').value.trim(),
    observaciones: document.getElementById('notes').value.trim()
  };

  // NUEVA URL CORRECTA DEL APPS SCRIPT
  var GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx3flCcCzABetU5OY-6Xtg3v6-HKkkumdbmXr7s0TrF5R5LzDVctU6IITlPgekzZXplaw/exec';

  fetch(GOOGLE_SCRIPT_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: {
      'Content-Type': 'text/plain;charset=utf-8'
    },
    body: JSON.stringify(reservationData)
  });

  setTimeout(function() {
    submitBooking.disabled = false;
    submitBooking.innerHTML = 'CONFIRMAR RESERVA';
    var localCode = 'RES-' + Math.random().toString(36).substr(2, 6).toUpperCase();
    showSuccess('RESERVA CONFIRMADA', 'Tu reserva ha sido guardada exitosamente.', localCode);
  }, 3000);
}
